"use strict";var state=document.querySelector("label[for='input_zone']"),drop_zone=document.querySelector("#upload"),input_zone=document.querySelector("#input_zone");drop_zone.addEventListener("dragstart",function(){dragstart_change()}),drop_zone.addEventListener("dragover",function(){dragover_change()}),drop_zone.addEventListener("dragleave",function(){dragleave_change()}),drop_zone.addEventListener("dragend",function(){dragend_clear()}),drop_zone.addEventListener("drop",function(){drop_upload()}),input_zone.addEventListener("change",function(){input_upload()});function dragstart_change(){state.className="",state.classList.add("drop_wait"),event.preventDefault()}function dragover_change(){state.className="",state.classList.add("drop_hover"),event.preventDefault()}function dragleave_change(){state.className="",state.classList.add("drop_wait"),event.preventDefault()}function dragend_clear(){var a=event.dataTransfer;if(a.items)for(var b=0;b<a.items.length;b++)a.items.remove(b);else event.dataTransfer.clearData()}function drop_upload(){for(var a=new XMLHttpRequest,b=new FormData,c=event.dataTransfer,d=0;d<c.files.length;d++)b.append("userfile[]",c.files[d]);a.open("post","/api/upload",!0),a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);state.className="",state.classList.add("drop_it"),addFile(a)}else console.log(this.status)},a.upload.onprogress=function(){console.log("event.lengthComputable:"+event.lengthComputable),console.log("event.loaded:"+event.loaded),console.log("event.total:"+event.total);var a=event.total,b=event.loaded;console.log(100*b/a)},a.onerror=function(){},a.send(b)}function input_upload(){var a=new XMLHttpRequest,b=new FormData(document.querySelector("#upload"));return!(0>b.getAll("userfile[]").length)&&void(a.open("post","/api/upload",!0),a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);state.className="",state.classList.add("drop_it"),addFile(a),input_zone.value=""}else;},a.upload.onprogress=function(){console.log("event.lengthComputable:"+event.lengthComputable),console.log("event.loaded:"+event.loaded),console.log("event.total:"+event.total);var a=event.total,b=event.loaded;console.log(100*b/a)},a.onerror=function(){},a.send(b))}function addFile(a){var b="",c=JSON.parse(window.atob(document.querySelector("#edit-upload").value.substr(1)));a.forEach(function(a){if(a.file_name){switch(console.log(a.file_name),b="",a.file_type.split("/")[0]){case"image":b=document.createElement("IMG");break;case"audio":b=document.createElement("AUDIO"),b.setAttribute("controls","controls");break;case"video":b=document.createElement("VIDEO"),b.setAttribute("controls","controls");break;default:b=document.createElement("A"),b.setAttribute("download","");}b.setAttribute("src",a.default_path+a.file_name),b.setAttribute("alt",a.client_name),document.querySelector("#edit-content").appendChild(b),document.querySelector("#edit-content").innerHTML+="<br/><br/>",c.push({file_name:a.file_name,file_type:a.file_type,client_name:a.client_name,file_size:a.file_size})}else document.querySelector("#edit-content").innerHTML+=a}),document.querySelector("#edit-upload").value="Z"+window.btoa(JSON.stringify(c))}function done(a){alert("save done"),redirect(a)}function fail(a){console.log(a),alert("try again")}document.querySelector("body").addEventListener("click",function(a){var b=a.target;switch(b.id){case"save":var c=[];c.push({info:__URL__,title:document.querySelector("#edit-title").value,content:document.querySelector("#edit-content").innerHTML,upload:document.querySelector("#edit-upload").value});var d=(document.querySelector("#edit-mode")||{value:"post"}).value;httpRequest(d,"/api/request/edit/save",JSON.stringify(c),done,fail);break;case"cancel":back();}});