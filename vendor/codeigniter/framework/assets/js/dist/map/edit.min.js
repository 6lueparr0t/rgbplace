'use strict';var tab='view',editor_position=document.querySelector('#edit-content'),state=document.querySelector('label[for=\'input_zone\']'),drop_zone=document.querySelector('#upload'),input_zone=document.querySelector('#input_zone');drop_zone.addEventListener('dragstart',function(){dragstart_change()}),drop_zone.addEventListener('dragover',function(){dragover_change()}),drop_zone.addEventListener('dragleave',function(){dragleave_change()}),drop_zone.addEventListener('dragend',function(){dragend_clear()}),drop_zone.addEventListener('drop',function(){drop_upload()}),input_zone.addEventListener('change',function(){input_upload()});function dragstart_change(){state.className='',state.classList.add('drop_wait'),event.preventDefault()}function dragover_change(){state.className='',state.classList.add('drop_hover'),event.preventDefault()}function dragleave_change(){state.className='',state.classList.add('drop_wait'),event.preventDefault()}function dragend_clear(){var a=event.dataTransfer;if(a.items)for(var b=0;b<a.items.length;b++)a.items.remove(b);else event.dataTransfer.clearData()}function drop_upload(){for(var a=new XMLHttpRequest,b=new FormData,c=event.dataTransfer,d=0;d<c.files.length;d++)b.append('userfile[]',c.files[d]);a.open('post','/api/upload',!0),a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);state.className='',state.classList.add('drop_it'),addFile(a),addList(a),input_zone.value=''}else console.log(this.status)},a.upload.onprogress=function(){console.log('event.lengthComputable:'+event.lengthComputable),console.log('event.loaded:'+event.loaded),console.log('event.total:'+event.total);var a=event.total,b=event.loaded;console.log(100*b/a)},a.onerror=function(){},a.send(b)}function input_upload(){var a=new XMLHttpRequest,b=new FormData(document.querySelector('#upload'));return!(0>b.getAll('userfile[]').length)&&void(a.open('post','/api/upload',!0),a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);state.className='',state.classList.add('drop_it'),addFile(a),addList(a),input_zone.value=''}else;},a.upload.onprogress=function(){console.log('event.lengthComputable:'+event.lengthComputable),console.log('event.loaded:'+event.loaded),console.log('event.total:'+event.total);var a=event.total,b=event.loaded;console.log(100*b/a)},a.onerror=function(){},a.send(b))}function addList(a){var b='',c=document.querySelector('.file-list');c.classList.contains('no-file')&&(c.classList.remove('no-file'),c.innerHTML='',document.querySelector('#upload-list-toggle').click()),a.forEach(function(a){b='<li class=\'file\' ',b+='data-default-path=\''+a.default_path+'\' ',b+='data-file-name=\''+a.file_name+'\' ',b+='data-client-name=\''+a.client_name+'\' ',b+='data-file-type=\''+a.file_type+'\' ',b+='data-size=\''+a.file_size+'\' ',b+='data-datetime=\''+a.datetime+'\'>',b+=a.client_name,b+='<span class=\'del fas fa-trash-alt\'></span>',b+='<span class=\'add fas fa-check\'></span>',b+='</li>',c.innerHTML+=b})}function addFile(a){var b='',c='';a.forEach(function(a){if(a.file_name){switch(console.log(a.file_name),b='',c='',a.file_type.split('/')[0]){case'image':b=document.createElement('IMG'),b.style.maxWidth='100%',b.setAttribute('src',a.default_path+a.file_name),b.setAttribute('alt',a.client_name),c='<img style=\'max-width:100%;\' src=\''+a.default_path+a.file_name+'\' alt=\''+a.client_name+'\'/>';break;case'audio':b=document.createElement('AUDIO'),b.setAttribute('controls','controls'),b.setAttribute('src',a.default_path+a.file_name),b.setAttribute('alt',a.client_name),c='<audio controls src=\''+a.default_path+a.file_name+'\' alt=\''+a.client_name+'\'/>';break;case'video':b=document.createElement('VIDEO'),b.setAttribute('controls','controls'),b.setAttribute('src',a.default_path+a.file_name),b.setAttribute('alt',a.client_name),c='<video controls src=\''+a.default_path+a.file_name+'\' alt=\''+a.client_name+'\'/>';break;default:b=document.createElement('A'),b.setAttribute('download',''),b.setAttribute('href',a.default_path+a.file_name),b.setAttribute('alt',a.client_name),c='<a href=\''+a.default_path+a.file_name+'\' alt=\''+a.client_name+'\' download />';}'view'==tab?(editor_position.appendChild(b),document.querySelector('#edit-content').innerHTML+='<br/><br/>'):document.querySelector('#edit-content-code').value+=c+'<br/><br/>'}else'view'==tab?editor_position.innerHTML+=a:document.querySelector('#edit-content-code').value+=a})}function delFile(a){var b={file_name:a.getAttribute('data-file-name'),client_name:a.getAttribute('data-client-name')};return httpRequest('post','/api/remove',JSON.stringify(b),function(){},fail),!0}function done(a){Swal.fire({type:'success',title:'Done',html:'\uB4F1\uB85D \uC644\uB8CC<br/>Save and Post Done!'}).then(function(){redirect(a)})}function fail(a){console.log(a),Swal.fire({type:'error',title:'Fail',html:'session lost. sign in please.'})}function tabChange(a){document.querySelectorAll('.tab div').forEach(function(a){a.classList.remove('active')}),a.classList.add('active')}document.querySelector('#edit-content').addEventListener('keydown',function(){editor_position=window.getSelection().anchorNode}),document.querySelector('#edit-content').addEventListener('click',function(){editor_position=window.getSelection().anchorNode}),document.querySelector('#edit').addEventListener('click',function(a){var b,c,d,e=a.target,f=document.querySelector('#edit-content'),g=document.querySelector('#edit-content-code'),h=[];switch(e.classList.item(0)){case'view':return void(void 0===e.classList[1]&&(tab='view',tabChange(e),f.innerHTML=g.value,f.classList.remove('none'),f.classList.add('active'),g.classList.add('none'),g.classList.remove('active')));break;case'code':return void(void 0===e.classList[1]&&(tab='code',tabChange(e),g.value=f.innerHTML.replace(/\n*(<\/?div|<img)/gi,'\n$1'),g.classList.remove('none'),g.classList.add('active'),f.classList.add('none'),f.classList.remove('active')));break;case'add':return h.push({default_path:e.parentElement.getAttribute('data-default-path'),file_name:e.parentElement.getAttribute('data-file-name'),client_name:e.parentElement.getAttribute('data-client-name'),file_type:e.parentElement.getAttribute('data-file-type')}),void addFile(h);break;case'del':delFile(e.parentElement)&&e.parentElement.remove();break;case'file':return void(e.getAttribute('data-default-path')&&e.getAttribute('data-file-name')&&(document.querySelector('#upload-preview-img').src=e.getAttribute('data-default-path')+e.getAttribute('data-file-name')));}switch(e.id){case'save':if(b=document.querySelector('#edit-title'),!b.value)return b.setCustomValidity('\uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.\nPlease Input Title'),b.reportValidity(),!1;if(c=document.querySelector('.editor.active'),d='edit-content'==c.id?c.innerHTML:c.value,!d)return Swal.fire({type:'error',title:'Oops...',html:'\uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.<br/>Please Input Content.'}),!1;Swal.fire({title:'Are you sure?',html:'\uB4F1\uB85D \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?<br/>Are you sure you want to post it?',type:'warning',showCancelButton:!0,confirmButtonColor:'#3085d6',cancelButtonColor:'#d33',confirmButtonText:'Yes!'}).then(function(a){if(a.value&&b&&d){h.push({info:__URL__,title:document.querySelector('#edit-title').value,content:d.replace(/\n/gi,'')});var c={value:'post'}.value;httpRequest(c,'/api/request/edit/save',JSON.stringify(h),done,fail)}});break;case'cancel':back();break;case'upload-list-toggle':var i=e.querySelector('#upload-list-switch');e.classList.toggle('show'),e.nextSibling.nextSibling.classList.toggle('close'),i.className=e.classList.contains('show')?'fa fa-caret-up':'fas fa-caret-down';}}),!function(){document.querySelector('.view').click()}();