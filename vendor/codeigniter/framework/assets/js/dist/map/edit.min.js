"use strict";window.addEventListener("beforeunload",onUnload);var tab="code",title=document.querySelector("#edit-title"),edit_width=document.querySelector(".tab"),edit_content_code=document.querySelector("#edit-content-code"),edit_content_view=document.querySelector("#edit-content-view"),editor=CodeMirror.fromTextArea(document.querySelector("#edit-content-code"),{lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0});editor.on("cursorActivity",function(){sync(),edit_content_view.scrollTo(0,editor.getCursor().line/editor.lineCount()*edit_content_view.scrollHeight)}),window.onresize=function(){!1===edit_content_view.classList.contains("none")?(editor.setSize(edit_width.clientWidth/2+"px","42rem"),edit_content_view.parentElement.style.width=edit_width.clientWidth/2+"px"):(editor.setSize(edit_width.clientWidth,"42rem"),edit_content_view.parentElement.style.width=edit_width.clientWidth)};var state=document.querySelector("label[for='input_zone']"),drop_zone=document.querySelector("#upload"),input_zone=document.querySelector("#input_zone");drop_zone.addEventListener("dragstart",function(){dragstart_change()}),drop_zone.addEventListener("dragover",function(){dragover_change()}),drop_zone.addEventListener("dragleave",function(){dragleave_change()}),drop_zone.addEventListener("dragend",function(){dragend_clear()}),drop_zone.addEventListener("drop",function(){drop_upload()}),input_zone.addEventListener("change",function(){input_upload()});function dragstart_change(){state.className="",state.classList.add("drop_wait"),event.preventDefault()}function dragover_change(){state.className="",state.classList.add("drop_hover"),event.preventDefault()}function dragleave_change(){state.className="",state.classList.add("drop_wait"),event.preventDefault()}function dragend_clear(){var a=event.dataTransfer;if(a.items)for(var b=0;b<a.items.length;b++)a.items.remove(b);else event.dataTransfer.clearData()}function drop_upload(){for(var a=new XMLHttpRequest,b=new FormData,c=event.dataTransfer,d=0;d<c.files.length;d++)b.append("userfile[]",c.files[d]);a.open("post","/api/upload",!0),a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);state.className="",state.classList.add("drop_it"),addFile(a),addList(a),input_zone.value=""}else console.log(this.status)},a.upload.onprogress=function(){console.log("event.lengthComputable:"+event.lengthComputable),console.log("event.loaded:"+event.loaded),console.log("event.total:"+event.total);var a=event.total,b=event.loaded;console.log(100*b/a)},a.onerror=function(){},a.send(b)}function input_upload(){var a=new XMLHttpRequest,b=new FormData(document.querySelector("#upload"));return!(0>b.getAll("userfile[]").length)&&void(a.open("post","/api/upload",!0),a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);state.className="",state.classList.add("drop_it"),addFile(a),addList(a),input_zone.value=""}else;},a.upload.onprogress=function(){console.log("event.lengthComputable:"+event.lengthComputable),console.log("event.loaded:"+event.loaded),console.log("event.total:"+event.total);var a=event.total,b=event.loaded;console.log(100*b/a)},a.onerror=function(){},a.send(b))}function addList(a){var b="",c=document.querySelector(".file-list");a.forEach(function(a){a.file_name!=void 0&&(c.classList.contains("no-file")&&(c.classList.remove("no-file"),c.innerHTML=""),b="<li class='file' ",b+="data-default-path='"+a.default_path+"' ",b+="data-file-name='"+a.file_name+"' ",b+="data-client-name='"+a.client_name+"' ",b+="data-file-type='"+a.file_type+"' ",b+="data-size='"+a.file_size+"' ",b+="data-datetime='"+a.datetime+"'>",b+=a.client_name,b+="<span class='del fas fa-trash-alt'></span>",b+="<span class='add fas fa-check'></span>",b+="</li>",c.innerHTML+=b)})}function addFile(a){var b,c,d,e;a.forEach(function(a){if(a.file_name){switch(console.log(a.file_name),a.file_type.split("/")[0]){case"image":b=document.createElement("IMG"),b.style.maxWidth="100%",b.setAttribute("src",a.default_path+a.file_name),b.setAttribute("alt",a.client_name),c="<img src='"+a.default_path+a.file_name+"' alt='"+a.client_name+"' width='100%' height='100%' />";break;case"audio":b=document.createElement("AUDIO"),b.setAttribute("controls","controls"),b.setAttribute("src",a.default_path+a.file_name),b.setAttribute("alt",a.client_name),c="<audio controls src='"+a.default_path+a.file_name+"' alt='"+a.client_name+"'/>";break;case"video":b=document.createElement("VIDEO"),b.setAttribute("controls","controls"),b.setAttribute("src",a.default_path+a.file_name),b.setAttribute("alt",a.client_name),c="<video controls src='"+a.default_path+a.file_name+"' alt='"+a.client_name+"'/>";break;default:b=document.createElement("A"),b.setAttribute("download",""),b.setAttribute("href",a.default_path+a.file_name),b.setAttribute("alt",a.client_name),c="<a href='"+a.default_path+a.file_name+"' alt='"+a.client_name+"' download />";}d=editor.getDoc(),e=d.getCursor(),d.replaceRange(c,e),sync()}})}function delFile(a){var b={info:__URL__,file_name:a.getAttribute("data-file-name"),client_name:a.getAttribute("data-client-name")};return httpRequest("post","/api/remove",JSON.stringify(b),function(){},fail),!0}function done(a){window.removeEventListener("beforeunload",onUnload);Swal.fire({type:"success",title:"Done",html:"\uB4F1\uB85D \uC644\uB8CC<br/>Save and Post Done!"}).then(function(){redirect(a)})}function fail(a){console.log(a),Swal.fire({type:"error",title:"Fail",html:"session lost. sign in please."})}function sync(){edit_content_view.classList.contains("none")||(edit_content_view.innerHTML=marked(editor.getValue().replace(/!\[(.*)\]\((.*)\)/g,"<img src=\"$2\" alt=\"$1\" />")))}document.querySelector("#edit").addEventListener("click",function(a){var b,c=a.target,d=[];switch(c.classList.item(0)){case"code":return void(edit_content_view.classList.contains("none")||(tab=c.classList.item(0),c.classList.toggle("active"),edit_content_code.classList.toggle("none"),edit_content_code.parentElement.classList.toggle("none"),window.onresize(),editor.refresh(),sync()));case"view":return void(edit_content_code.classList.contains("none")||(tab=c.classList.item(0),c.classList.toggle("active"),edit_content_view.classList.toggle("none"),edit_content_view.parentElement.classList.toggle("none"),window.onresize(),editor.refresh(),sync()));case"add":return d.push({default_path:c.parentElement.getAttribute("data-default-path"),file_name:c.parentElement.getAttribute("data-file-name"),client_name:c.parentElement.getAttribute("data-client-name"),file_type:c.parentElement.getAttribute("data-file-type")}),void addFile(d);break;case"del":delFile(c.parentElement),c.parentElement.remove();break;case"file":return void(c.getAttribute("data-default-path")&&c.getAttribute("data-file-name")&&(document.querySelector("#upload-preview-img").src=c.getAttribute("data-default-path")+c.getAttribute("data-file-name")));}switch(c.id){case"save":if(!title.value)return title.setCustomValidity("\uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.\nPlease Input Title"),title.reportValidity(),!1;if(b=editor.getValue(),!b)return Swal.fire({type:"error",title:"Oops...",html:"\uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.<br/>Please Input Content."}),!1;Swal.fire({title:"Are you sure?",html:"\uB4F1\uB85D \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?<br/>Are you sure you want to post it?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(function(a){if(a.value&&title&&b){d.push({info:__URL__,title:title.value,content:b});var c={value:"post"}.value;httpRequest(c,"/api/request/edit/save",JSON.stringify(d),done,fail)}});break;case"cancel":back();break;case"upload-list-toggle":var e=c.querySelector("#upload-list-switch");c.classList.toggle("show"),c.nextSibling.nextSibling.classList.toggle("close"),e.className=c.classList.contains("show")?"fa fa-caret-up":"fas fa-caret-down";}}),!function(){window.onresize(),sync()}();